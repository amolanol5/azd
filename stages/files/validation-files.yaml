parameters:
  - name: folder_cognito_users
    type: string
  - name: stage
    type: string



stages:
  # Primer Stage para validar los cambios
  - stage: ValidationStage
    jobs:
      - job: ValidateChanges
        displayName: "Validar cambios en archivos especÃ­ficos"
        variables:
        - name: FOLDER
          value: cognito-delete-users        
        steps:
          - checkout: self
          - script: |
              git diff-tree HEAD
              git diff-tree --no-commit-id --name-only -r HEAD > files.txt
              cat files.txt

          - script: |
              if cat files.txt | grep -q "^$FOLDER/users-prod.yaml"; then
                echo "Se detectaron cambios en archivos relevantes."
                echo "##vso[task.setvariable variable=changesDetected]true"
              else
                echo "No se detectaron cambios relevantes."
                echo "##vso[task.setvariable variable=changesDetected]false"
              fi  

  - stage: ConditionalStage
    dependsOn: ValidationStage
    condition: eq(dependencies.ValidationStage.outputs['ValidateChanges.changesDetected'], 'true')
    jobs:
      - job: RunIfChangesDetected
        displayName: "Ejecutar si hay cambios detectados"
        steps:
          - script: echo "Se han detectado cambios relevantes. Ejecutando Stage Condicional..."